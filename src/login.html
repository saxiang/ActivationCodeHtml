<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <!-- 关键：添加viewport，避免移动端解析异常，同时让浏览器严格按标准解析 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>后台登录</title>
  <!-- 引入Element Plus样式（放在head里，避免样式加载延迟） -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.css">
  <style>
    .login-container {
      width: 400px;
      margin: 100px auto;
      padding: 20px;
      border: 1px solid #e6e6e6;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="app" class="login-container">
    <el-form ref="loginForm" :model="loginForm" :rules="rules" label-width="80px">
      <el-form-item label="用户名" prop="username">
        <el-input v-model="loginForm.username"></el-input>
      </el-form-item>
      <el-form-item label="密码" prop="password">
        <el-input v-model="loginForm.password" type="password"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="login">登录</el-button>
      </el-form-item>
    </el-form>
  </div>

  <!-- 按顺序引入依赖：先Vue，再Element Plus，最后axios（避免依赖顺序错误） -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3.3.8/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.full.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>

  <script>
    // 确保Vue和Element Plus全局可用
    const { createApp } = Vue;
    const app = createApp({
      data() {
        return {
          loginForm: {
            username: "admin", // 直接默认填充，减少mounted逻辑
            password: "123456"
          },
          rules: {
            username: [{ required: true, message: "请输入用户名", trigger: "blur" }],
            password: [{ required: true, message: "请输入密码", trigger: "blur" }]
          }
        };
      },
      methods: {
        async login() {
          try {
            // 简化请求，确保参数正确
            const response = await axios({
              url: "http://localhost:8000/login",
              method: "POST",
              data: {
                username: this.loginForm.username,
                password: this.loginForm.password
              },
              headers: {
                "Content-Type": "application/json" // 显式指定JSON格式
              }
            });
            // 保存token并跳转
            localStorage.setItem("token", response.data.access_token);
            window.location.href = "/src/manage.html"; // 确保管理页路径正确
          } catch (error) {
            // 详细打印错误，方便排查
            console.error("登录失败：", error);
            ElMessage.error(error.response?.data?.detail || "登录失败，请检查后端是否启动");
          }
        }
      }
    });
    // 全局注册Element Plus
    app.use(ElementPlus);
    // 挂载到#app，确保DOM加载完成
    app.mount("#app");
  </script>
</body>
</html>